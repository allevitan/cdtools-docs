

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Datasets &mdash; CDTools 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Models" href="models.html" />
    <link rel="prev" title="General Reference" href="general.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CDTools
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction to CDTools</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="general.html">General Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="indices_tables.html">Indices and tables</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CDTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Datasets</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/datasets.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="module-cdtools.datasets">
<span id="datasets"></span><h1>Datasets<a class="headerlink" href="#module-cdtools.datasets" title="Permalink to this heading">¶</a></h1>
<p>This module contains all the datasets for interacting with ptychography data</p>
<p>All the access to data from standard ptychography and CDI experiments is
coordinated through the various datasets defined in this module. They make use
of the lower-level data reading and writing functions defined in tools.data,
but critically all of these datasets subclass torch.Dataset. This allows
them to be used as standard torch datasets during reconstructions, which
helps make it easy to use the various data-handling strategies that are
implemented by default in pytorch (such as drawing data in a random order,
drawing minibatches, etc.)</p>
<p>New Datasets can be defined a subclass of the main CDataset class defined
in the base.py file, and should define the following functions:</p>
<ul class="simple">
<li><p>__init__</p></li>
<li><p>__len__</p></li>
<li><p>_load</p></li>
<li><p>to</p></li>
<li><p>from_cxi</p></li>
<li><p>to_cxi</p></li>
<li><p>inspect</p></li>
</ul>
<p>Example implementations of all these functions can be found in the code
for the Ptycho2DDataset class. In addition, it is recommended to read
through the tutorial section on defining a new CDI dataset before
attempting to do so</p>
<dl class="py class">
<dt class="sig sig-object py" id="cdtools.datasets.CDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">cdtools.datasets.</span></span><span class="sig-name descname"><span class="pre">CDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">entry_info</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_info</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wavelength</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detector_geometry</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">background</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.CDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></p>
<p>The base dataset class which all other datasets subclass</p>
<p>Subclasses torch.utils.data.Dataset</p>
<p>This base dataset class defines the functionality which should be
common to all subclassed datasets. This includes the loading and
storage of the metadata portions of .cxi files, as well as the tools
needed to allow for easy mixing of data on the CPU and GPU.</p>
<p>The __init__ function allows construction from python objects.</p>
<p>The detector_geometry dictionary is defined to have the
entries defined by the outputs of data.get_detector_geometry.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>entry_info</strong> (<em>dict</em>) – A dictionary containing the entry_info metadata</p></li>
<li><p><strong>sample_info</strong> (<em>dict</em>) – A dictionary containing the sample_info metadata</p></li>
<li><p><strong>wavelength</strong> (<em>float</em>) – The wavelength of light used in the experiment</p></li>
<li><p><strong>detector_geometry</strong> (<em>dict</em>) – A dictionary containing the various detector geometry
parameters</p></li>
<li><p><strong>mask</strong> (<em>array</em>) – A mask for the detector, defined as 1 for live pixels, 0
for dead</p></li>
<li><p><strong>background</strong> (<em>array</em>) – An initial guess for the not-previously-subtracted
detector background</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.CDataset._load">
<span class="sig-name descname"><span class="pre">_load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.CDataset._load" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal function to load data</p>
<p>In all subclasses of CDataset, a _load function should be defined.
This function is used internally by the global __getitem__ function
defined in the base class, which handles moving data around when
the dataset is (for example) storing the data on the CPU but
getting data as GPU tensors.</p>
<p>It should accept an index or slice, and return output as a tuple.
The first item of the tuple is a tuple containing the inputs to
the forward model for the related ptychography model. The second
item of the tuple should be the set of diffraction patterns
associated with the returned inputs.</p>
<p>Since there is no kind of data stored in a CDataset, this
function is defined as returing a NotImplemented Error</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.CDataset.from_cxi">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_cxi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cxi_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.CDataset.from_cxi" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a new CDataset from a .cxi file directly</p>
<p>This is the most commonly used constructor for CDatasets and
subclasses thereof. It populates the dataset using the information
in a .cxi file. It can either take an h5py.File object directly,
or a filename or pathlib object pointing to the file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>file</strong> (<em>str</em><em>, </em><em>pathlib.Path</em><em>, or </em><em>h5py.File</em>) – The .cxi file to load from</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset</strong> – The constructed dataset object</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cdtools.datasets.CDataset" title="cdtools.datasets.CDataset">CDataset</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.CDataset.get_as">
<span class="sig-name descname"><span class="pre">get_as</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.CDataset.get_as" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the dataset to return data on the given device and dtype</p>
<p>Oftentimes there isn’t room to store an entire dataset on a GPU,
but it is still worth running the calculation on the GPU even with
the overhead incurred by transferring data back and forth. In that
case, get_as can be used instead of to, to declare a set of
device and dtype that the data should be returned as, whenever it
is accessed through the __getitem__ function (as it would be in
any reconstructions).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>torch.Tensor.to</strong> (<em>Accepts the same parameters as</em>) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.CDataset.inspect">
<span class="sig-name descname"><span class="pre">inspect</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.CDataset.inspect" title="Permalink to this definition">¶</a></dt>
<dd><p>The prototype for the inspect function</p>
<p>In all subclasses of CDataset, an inspect function should be
defined which opens a tool that shows the data in a natural
layout for that kind of experiment. In the base class, no actual
data is stored, so this is defined to raise a NotImplementedError</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.CDataset.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.CDataset.to" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends the relevant data to the given device and dtype</p>
<p>This function sends the stored mask and background to the
specified device and dtype</p>
<p>Accepts the same parameters as torch.Tensor.to</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.CDataset.to_cxi">
<span class="sig-name descname"><span class="pre">to_cxi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cxi_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.CDataset.to_cxi" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves out a CDataset as a .cxi file</p>
<p>This function saves all the compatible information in a CDataset
object into a .cxi file. This is useful for saving out modified
or simulated datasets</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cxi_file</strong> (<em>str</em><em>, </em><em>pathlib.Path</em><em>, or </em><em>h5py.File</em>) – The .cxi file to write to</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="cdtools.datasets.PolarizedPtycho2DDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">cdtools.datasets.</span></span><span class="sig-name descname"><span class="pre">PolarizedPtycho2DDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">translations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">polarizer_angles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">analyzer_angles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patterns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.PolarizedPtycho2DDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#cdtools.datasets.Ptycho2DDataset" title="cdtools.datasets.ptycho_2d_dataset.Ptycho2DDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Ptycho2DDataset</span></code></a></p>
<p>The standard dataset for a 2D ptychography scan</p>
<p>Subclasses datasets.Ptycho2DDataset</p>
<p>This class loads and saves 2D ptychography scan data from .cxi files.
It should save and load files compatible with most reconstruction
programs, although it is only tested against SHARP.</p>
<p>The __init__ function allows construction from python objects.</p>
<p>The detector_geometry dictionary is defined to have the
entries defined by the outputs of data.get_detector_geometry.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>translations</strong> (<em>array</em><em> (</em><em>nx3 t.tensor when polarized=True</em><em>)</em>) – An nx3 array containing the probe translations at each scan point</p></li>
<li><p><strong>patterns</strong> (<em>array</em>) – An nxmxl array containing the full stack of measured diffraction patterns</p></li>
<li><p><strong>axes</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – <dl class="simple">
<dt>A</dt><dd><p>of names for the axes of the probe translations</p>
</dd>
</dl>
</p></li>
<li><p><strong>entry_info</strong> (<em>dict</em>) – A dictionary containing the entry_info metadata</p></li>
<li><p><strong>sample_info</strong> (<em>dict</em>) – A dictionary containing the sample_info metadata</p></li>
<li><p><strong>wavelength</strong> (<em>float</em>) – The wavelength of light used in the experiment</p></li>
<li><p><strong>detector_geometry</strong> (<em>dict</em>) – A dictionary containing the various detector geometry
parameters</p></li>
<li><p><strong>mask</strong> (<em>array</em>) – A mask for the detector, defined as 1 for live pixels, 0
for dead</p></li>
<li><p><strong>background</strong> (<em>array</em>) – An initial guess for the not-previously-subtracted
detector background</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.PolarizedPtycho2DDataset._load">
<span class="sig-name descname"><span class="pre">_load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.PolarizedPtycho2DDataset._load" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal function to load data</p>
<p>This function is used internally by the global __getitem__ function
defined in the base class, which handles moving data around when
the dataset is (for example) storing the data on the CPU but
getting data as GPU tensors.</p>
<p>It loads data in the format (inputs, output)</p>
<p>The inputs for a 2D ptychogaphy data set are:</p>
<ol class="arabic simple">
<li><p>The indices of the patterns to use</p></li>
<li><p>The recorded probe positions associated with those points</p></li>
<li><p>The angles of the polarizers if polarized=True</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>(</strong><strong>polarized=False</strong><strong>)</strong> (<em>index</em>) – The index or indices of the scan points to use</p></li>
<li><p><strong>(</strong><strong>polarized=True</strong><strong>)</strong> (<em>index</em>) – <p>tuple ((phi1, phi2), ind)</p>
<p>ind - index or indices of the scan points to use (in a (phi1, phi2) polarization state), int or slice
(phi1, phi2) - angles of the 1st and 2nd polarizers, ints</p>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>inputs</strong> (<em>tuple</em>) – A tuple of the inputs to the related forward models
if polarized: inputs = ((phi1, phi2), ind, transl[(phi1, phi2)][ind])</p></li>
<li><p><strong>outputs</strong> (<em>tuple</em>) – The output pattern or stack of output patterns</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.PolarizedPtycho2DDataset.from_cxi">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_cxi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cxi_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cut_zeros</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.PolarizedPtycho2DDataset.from_cxi" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a new PolarizedPtycho2DDataset from a .cxi file directly</p>
<p>This generates a new PolarizedPtycho2DDataset from a .cxi file storing
a 2D ptychography scan.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file</strong> (<em>str</em><em>, </em><em>pathlib.Path</em><em>, or </em><em>h5py.File</em>) – The .cxi file to load from</p></li>
<li><p><strong>cut_zeros</strong> (<em>bool</em>) – Default True, whether to set all negative data to zero</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset</strong> – The constructed dataset object</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cdtools.datasets.PolarizedPtycho2DDataset" title="cdtools.datasets.PolarizedPtycho2DDataset">PolarizedPtycho2DDataset</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.PolarizedPtycho2DDataset.inspect">
<span class="sig-name descname"><span class="pre">inspect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logarithmic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'um'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.PolarizedPtycho2DDataset.inspect" title="Permalink to this definition">¶</a></dt>
<dd><p>Launches an interactive plot for perusing the data</p>
<p>This launches an interactive plotting tool in matplotlib that
shows the spatial map constructed from the integrated intensity
at each position on the left, next to a panel on the right that
can display a base-10 log plot of the detector readout at each
position.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.PolarizedPtycho2DDataset.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.PolarizedPtycho2DDataset.to" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends the relevant data to the given device and dtype</p>
<p>This function sends the stored translations, patterns,
mask and background to the specified device and dtype</p>
<p>Accepts the same parameters as torch.Tensor.to</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.PolarizedPtycho2DDataset.to_cxi">
<span class="sig-name descname"><span class="pre">to_cxi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cxi_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">polarized</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.PolarizedPtycho2DDataset.to_cxi" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves out a PolarizedPtycho2DDataset as a .cxi file</p>
<p>This function saves all the compatible information in a
PolarizedPtycho2DDataset object into a .cxi file. This saved .cxi file
should be compatible with any standard .cxi file based
reconstruction tool, such as SHARP.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cxi_file</strong> (<em>str</em><em>, </em><em>pathlib.Path</em><em>, or </em><em>h5py.File</em>) – The .cxi file to write to</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="cdtools.datasets.Ptycho2DDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">cdtools.datasets.</span></span><span class="sig-name descname"><span class="pre">Ptycho2DDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">translations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patterns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intensities</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.Ptycho2DDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#cdtools.datasets.CDataset" title="cdtools.datasets.base.CDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">CDataset</span></code></a></p>
<p>The standard dataset for a 2D ptychography scan</p>
<p>Subclasses datasets.CDataset</p>
<p>This class loads and saves 2D ptychography scan data from .cxi files.
It should save and load files compatible with most reconstruction
programs, although it is only tested against SHARP.</p>
<p>The __init__ function allows construction from python objects.</p>
<p>The detector_geometry dictionary is defined to have the
entries defined by the outputs of data.get_detector_geometry.</p>
<p>Note that the created dataset object will not copy the data in the
patterns parameter in order to avoid doubling the memory requiement
for large datasets.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>translations</strong> (<em>array</em>) – An nx3 array containing the probe translations at each scan point</p></li>
<li><p><strong>patterns</strong> (<em>array</em>) – An nxmxl array containing the full stack of measured diffraction patterns</p></li>
<li><p><strong>axes</strong> (<em>list</em><em>(</em><em>str</em><em>)</em>) – A list of names for the axes of the probe translations</p></li>
<li><p><strong>entry_info</strong> (<em>dict</em>) – A dictionary containing the entry_info metadata</p></li>
<li><p><strong>sample_info</strong> (<em>dict</em>) – A dictionary containing the sample_info metadata</p></li>
<li><p><strong>wavelength</strong> (<em>float</em>) – The wavelength of light used in the experiment</p></li>
<li><p><strong>detector_geometry</strong> (<em>dict</em>) – A dictionary containing the various detector geometry
parameters</p></li>
<li><p><strong>mask</strong> (<em>array</em>) – A mask for the detector, defined as 1 for live pixels, 0
for dead</p></li>
<li><p><strong>background</strong> (<em>array</em>) – An initial guess for the not-previously-subtracted
detector background</p></li>
<li><p><strong>intensities</strong> (<em>array</em>) – A list of measured shot-to-shot intensities</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.Ptycho2DDataset._load">
<span class="sig-name descname"><span class="pre">_load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.Ptycho2DDataset._load" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal function to load data</p>
<p>This function is used internally by the global __getitem__ function
defined in the base class, which handles moving data around when
the dataset is (for example) storing the data on the CPU but
getting data as GPU tensors.</p>
<p>It loads data in the format (inputs, output)</p>
<p>The inputs for a 2D ptychogaphy data set are:</p>
<ol class="arabic simple">
<li><p>The indices of the patterns to use</p></li>
<li><p>The recorded probe positions associated with those points</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>index</strong> (<em>int</em><em> or </em><em>slice</em>) – The index or indices of the scan points to use</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>inputs</strong> (<em>tuple</em>) – A tuple of the inputs to the related forward models</p></li>
<li><p><strong>outputs</strong> (<em>tuple</em>) – The output pattern or stack of output patterns</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.Ptycho2DDataset.from_cxi">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_cxi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cxi_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cut_zeros</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_patterns</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.Ptycho2DDataset.from_cxi" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a new Ptycho2DDataset from a .cxi file directly</p>
<p>This generates a new Ptycho2DDataset from a .cxi file storing
a 2D ptychography scan.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file</strong> (<em>str</em><em>, </em><em>pathlib.Path</em><em>, or </em><em>h5py.File</em>) – The .cxi file to load from</p></li>
<li><p><strong>cut_zeros</strong> (<em>bool</em>) – Default True, whether to set all negative data to zero</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dataset</strong> – The constructed dataset object</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#cdtools.datasets.Ptycho2DDataset" title="cdtools.datasets.Ptycho2DDataset">Ptycho2DDataset</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.Ptycho2DDataset.inspect">
<span class="sig-name descname"><span class="pre">inspect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">logarithmic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">units</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'um'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.Ptycho2DDataset.inspect" title="Permalink to this definition">¶</a></dt>
<dd><p>Launches an interactive plot for perusing the data</p>
<p>This launches an interactive plotting tool in matplotlib that
shows the spatial map constructed from the integrated intensity
at each position on the left, next to a panel on the right that
can display a base-10 log plot of the detector readout at each
position.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.Ptycho2DDataset.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.Ptycho2DDataset.to" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends the relevant data to the given device and dtype</p>
<p>This function sends the stored translations, patterns,
mask and background to the specified device and dtype</p>
<p>Accepts the same parameters as torch.Tensor.to</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cdtools.datasets.Ptycho2DDataset.to_cxi">
<span class="sig-name descname"><span class="pre">to_cxi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cxi_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cdtools.datasets.Ptycho2DDataset.to_cxi" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves out a Ptycho2DDataset as a .cxi file</p>
<p>This function saves all the compatible information in a
Ptycho2DDataset object into a .cxi file. This saved .cxi file
should be compatible with any standard .cxi file based
reconstruction tool, such as SHARP.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cxi_file</strong> (<em>str</em><em>, </em><em>pathlib.Path</em><em>, or </em><em>h5py.File</em>) – The .cxi file to write to</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="models.html" class="btn btn-neutral float-right" title="Models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="general.html" class="btn btn-neutral float-left" title="General Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2021, Abraham Levitan

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>